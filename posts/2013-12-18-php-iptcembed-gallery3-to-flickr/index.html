<!DOCTYPE html>
<html lang="en-us"><head>
<meta name="generator" content="Hugo 0.65.3" />
  <title>PHP iptcembed Gallery3 to Flickr</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="anamika">
  <meta name="description" content="" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">

  
<script src="https://kit.fontawesome.com/d2c89115c5.js" crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
</head>

<body><nav class="navbar is-fixed-top has-shadow">
      <div class="container">
        <div class="navbar-brand">
          
								<a class="navbar-item" href="/" target="_blank"><i class="fas fa-home fa-2x"></i></a>
								
								<a class="navbar-item" href="/posts" target="_blank"><i class="fas fa-newspaper fa-2x"></i></a>
								
								<a class="navbar-item" href="https://www.flickr.com/photos/santm/collections" target="_blank"><i class="fas fa-camera fa-2x"></i></a>
								
								<a class="navbar-item" href="https://www.facebook.com/santm" target="_blank"><i class="fab fa-facebook-square fa-2x"></i></a>
								
								<a class="navbar-item" href="https://www.instagram.com/s.a.n.t.m/" target="_blank"><i class="fab fa-instagram-square fa-2x"></i></a>
								
                <span class="navbar-burger burger" data-target="navMenu">
                  <span></span>
                  <span></span>
                  <span></span>
                </span>
              </div>
              <div id="navMenu" class="navbar-menu">
                <div class="navbar-end">

<a href="/about/" class="navbar-item is-uppercase has-text-weight-bold "> About </a>
<a href="/contact/" class="navbar-item is-uppercase has-text-weight-bold "> Contact </a>
<a href="/tags/" class="navbar-item is-uppercase has-text-weight-bold "> Tags </a>
                </div>
                <form class="is-marginless" action="/search/" method="get">
                <div class="navbar-item field">
                <p class="control has-icons-right">
                <input id="header-search"  name="q" class="input" type="text" placeholder="Search...">
                <span class="icon is-small is-right">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#ddd" d="M23.822 20.88l-6.353-6.354c.93-1.465 1.467-3.2 1.467-5.059.001-5.219-4.247-9.467-9.468-9.467s-9.468 4.248-9.468 9.468c0 5.221 4.247 9.469 9.468 9.469 1.768 0 3.421-.487 4.839-1.333l6.396 6.396 3.119-3.12zm-20.294-11.412c0-3.273 2.665-5.938 5.939-5.938 3.275 0 5.94 2.664 5.94 5.938 0 3.275-2.665 5.939-5.94 5.939-3.274 0-5.939-2.664-5.939-5.939z"/></svg>
                </span>
                </p>
                </div>
                </form>
              </div>
            </div>
          </nav>
      <script>
          (function() {
            var burger = document.querySelector('.burger');
            var nav = document.querySelector('#'+burger.dataset.target);

            burger.addEventListener('click', function(){
              burger.classList.toggle('is-active');
              nav.classList.toggle('is-active');
            });
          })();
        </script>
<div id="content">
<div class="has-shadow" itemscope itemtype="http://schema.org/BlogPosting">
<section class="hero is-light is-bold">
  <div class="hero-body">
  <div class="container has-text-centered">
    <br><h1 class="title is-2">PHP iptcembed Gallery3 to Flickr</h1>
    <span class="icon"><i class="fa fa-tags"></i></span>
       
      
          
          
              <a href="https://blog.santm.com/tags/iptc/">iptc</a>
          
      
          
          
              <a href="https://blog.santm.com/tags/hosting/">hosting</a>
          
      
          
          
              <a href="https://blog.santm.com/tags/gallery-3/">gallery 3</a>
          
      
          
          
              <a href="https://blog.santm.com/tags/php/">PHP</a>
          
      
          
          
              <a href="https://blog.santm.com/tags/flickr/">flickr</a>
          
      
      <h4> December 18, 2013</h4>
    </div>
  </div>
</section>
<section class="section blog">
       <div class="container">
         <div class="columns is-mobile">
           <div class="column">
             <div class="content blog-post section has-text-justified" itemprop="articleBody">
               <br />
         <p>A journey of sharing photo only got me into having a website of my own.
When digital camera came out with decent mega pixel was an early adapter
of the same. But soon realized sharing Pictures on email was not an
option and  hosted pictures  on Tripod. Oh! they used to give 10MB of
free hosting :) now Flicker gives one 1TB free. So long  story small
after the managing own gallyery app writen initally with csv and php ,
later mysql and php and lastly Gallery for almost 10 years. found
gallery development is kind of not that active it used to be. So thought
of moving into Flickr which was big no in-between as they had
restriction on free accounts. But now those restriction gone managing
7000+ picture and importing them with proper details remained a BIG
challenage. At last came up with **iptcembed ** where all the details
where written into  JPEG file itself and imported those image as set to
Flickr.And all your details, tag, captions are set properly.</p>
<p>Here is how I did it</p>
<ol>
<li>Copy Gallery&rsquo;s items table to temp table so we do not mess with live
data</li>
<li>Add a new column to the temp table</li>
</ol>
<blockquote>
<p><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->ALTER<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->TABLE<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->`Yours_G3_items-new`<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->ADD<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->`album_name`<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->TEXT<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->NOT<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->NULL<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></strong><!-- raw HTML omitted --></p>
</blockquote>
<p>3. Find out the parent album id of each items and add that data in the
new column.</p>
<blockquote>
<p><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->UPDATE<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Yours_G3_items-new<!-- raw HTML omitted -->,<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Yours_G3_items<!-- raw HTML omitted -->  <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->SET<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Yours_G3_items-new<!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->album_name<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->=<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Yours_G3_items<!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->title<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><strong><!-- raw HTML omitted -->WHERE<!-- raw HTML omitted --></strong><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Yours_G3_items-new<!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->parent_id<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->=<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Yours_G3_items<!-- raw HTML omitted -->.<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->id<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</blockquote>
<p>4. Export the new table with &ldquo;|&rdquo; as separator and &quot;&rdquo; as enclosed.</p>
<p>Now the PHP script</p>
<blockquote>
<p><!-- raw HTML omitted -->&lt;?  
//File to be opened  
$file=&rdquo;/tmp/csv.txt&rdquo;;  
$gallery_album_base = &hellip;./gallery3/var/albums&rdquo;;  
$new_gallery_album_base = &lt;new location&gt;/albums&rdquo; ;  
//  
$handle = fopen($file, &lsquo;r&rsquo;) or die (&ldquo;Fail to open input file \n\r&rdquo;)
;  
$ln= 0 ;  
// Some Functions Start  
function csv_explode($delim='|&rsquo;, $str, $enclose=&rsquo;&quot;',
$preserve=false){  
$resArr = array();  
$n = 0;  
$expEncArr = explode($enclose, $str);  
foreach($expEncArr as $EncItem){  
if($n++%2){  
array_push($resArr, array_pop($resArr) . ($preserve?$enclose:'') .
$EncItem.($preserve?$enclose:''));  
}else{  
$expDelArr = explode($delim, $EncItem);  
array_push($resArr, array_pop($resArr) .
array_shift($expDelArr));  
$resArr = array_merge($resArr, $expDelArr);  
}  
}  
return $resArr;  
}</p>
<p>// iptc_make_tag() function by Thies C. Arntzen  
function iptc_make_tag($rec, $data, $value)  
{  
$length = strlen($value);  
$retval = chr(0x1C) . chr($rec) . chr($data);  
if($length &lt; 0x8000)  
{  
$retval .= chr($length &gt;&gt; 8) . chr($length &amp; 0xFF);  
}  
else  
{  
$retval .= chr(0x80) .  
chr(0x04) .  
chr(($length &gt;&gt; 24) &amp; 0xFF) .  
chr(($length &gt;&gt; 16) &amp; 0xFF) .  
chr(($length &gt;&gt; 8) &amp; 0xFF) .  
chr($length &amp; 0xFF);  
}  
return $retval . $value;  
}  
// Some Functions End  
while ($line = fgets ($handle)){  
$line = str_ireplace(&quot;\x0D&rdquo;, &ldquo;&quot;, $line);  
$line = urldecode ($line);  
++$ln;  
print (&ldquo;just line : $ln \n&rdquo;);  
if ($line===FALSE) print (&ldquo;FALSE\n&rdquo;);  
else {  
//print (&ldquo;I am $ln \n&rdquo;);  
//print ($line) ;  
$variables = csv_explode (&ldquo;|&rdquo;, $line);  
//print_r ($variables);  
//26(album or photo) 25(title), 13(image_path),
4(details),33(album_name/tag)</p>
<p>if ( $variables[26] == photo ){  
//Path new and old path  
$old_path = $gallery_album_base . &lsquo;/&rsquo; . $variables[13];  
$image_name_new = $new_gallery_album_base . &lsquo;/&rsquo; .
$variables[13];  
$path_parts = pathinfo ($image_name_new);  
if (!file_exists($path_parts[&lsquo;dirname&rsquo;])) {  
print (&ldquo;makeing directory {$path_parts[&lsquo;dirname&rsquo;]} \n&rdquo;) ;  
mkdir ($path_parts[&lsquo;dirname&rsquo;], 0777,true);  
}</p>
<p>// Set the IPTC tags  
$iptc = array(  
&lsquo;2#120&rsquo; =&gt; &ldquo;$variables[4]&quot;,  
&lsquo;2#105&rsquo; =&gt; &ldquo;$variables[25]&quot;,  
&lsquo;2#005&rsquo; =&gt; &ldquo;$variables[25]&quot;,  
&lsquo;2#015&rsquo; =&gt; &ldquo;$variables[33]&quot;,  
&lsquo;2#116&rsquo; =&gt; &lsquo;Copyright, www santm com&rsquo;  
);  
// Convert the IPTC tags into binary code  
$data = &lsquo;';  
foreach($iptc as $tag =&gt; $string)  
{  
$tag = substr($tag, 2);  
$data .= iptc_make_tag(2, $tag, $string);  
}  
// Embed the IPTC data  
$content = iptcembed($data, $old_path);  
// Write the new image data out to the file.  
$fp = fopen($image_name_new, &ldquo;wb&rdquo;);  
fwrite($fp, $content);  
fclose($fp);  
print (&ldquo;working on $image_name_new \n&rdquo;);  
//$size = getimagesize($image_name_new, $info);  
//if(isset($info[&lsquo;APP13&rsquo;]))  
//{  
// $iptc = iptcparse($info[&lsquo;APP13&rsquo;]);  
// var_dump($iptc);  
//}  
} //end of if photo loop  
} // end of else loop  
} // end of while loop  
# Close the File.  
fclose($handle);  
?&gt;<!-- raw HTML omitted --></p>
</blockquote>
<p>I Wish there was API where I could import the image from my old hosting
company to Flickr directly instead of uploading them via their PC
up-loader.</p>
<p>More here on major phpfunction</p>
<p><a href="http://www.php.net/function.iptcembed">http://www.php.net/function.iptcembed</a>  
<a href="http://www.php.net/function.pathinfo">http://www.php.net/function.pathinfo</a>  
<a href="http://php.net/manual/fr/function.explode.php">http://php.net/manual/fr/function.explode.php</a></p>

         </div>
         </div>
         </div>
         </div>
</section>
</div>

   <div class="container">
        <div class="tabs">
          <p class="control">
            
            <a class="button is-light" href="https://blog.santm.com/posts/2013-12-14-moving-away-from-self-hosting/" title="Moving  away from self hosting "><span class="icon is-small">
            <i class="fa fa-angle-double-left"></i></span><span>Previous</span></a>
            
          </p>
          <p class="control">
            
            <a class="button is-light" href="https://blog.santm.com/posts/2014-01-17-goa-beach-and-x-mas/" title="Goa  ...  beach and x-mas"><span>Next</span>
              <span class="icon is-small"><i class="fa fa-angle-double-right"></i></span></a>
            
          </p>
        </div>
    </div> 
</main>

        </div><footer class="footer">
  <div class="content has-text-centered">
    <a title="RSS Feed" href="/index.xml"><i class="fas fa-rss-square fa-lg"></i></a>
	<span class="icon has-text-link"> <i class="fas fa-copyright fa-lg has-tooltip-multiline" data-tooltip="Copyright 2020 Santanu Misra"></i> </span>
	All views represneted are personal | <span>Powered by 
	<span class="icon has-text-danger"><i class="fas fa-heart fa-lg"></i></span> 
	<a href="https://gohugo.io" rel="nofollow">Hugo </a> 
	<span class="icon has-text-primary"><i class="fas fa-mug-hot fa-lg"></i></span>
   </span>
  </div>
</footer>
</body>
</html>
